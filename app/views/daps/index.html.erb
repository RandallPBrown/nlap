  <script src="https://js.pusher.com/4.4/pusher.min.js"></script>
<%= stylesheet_link_tag("https://cdn.datatables.net/select/1.3.0/css/select.bootstrap4.min.css") %>
  <script>

$(document).ready(function(t){

var t = $('#dapsTable').DataTable({ 
        "pageLength": 10,
        select: true,
        dom: 'Bfrtip',
        buttons: [
          'copy', 'csvHtml5'
          ], 
        columns: [ 
              { data: 'Nature of Incident'}, 
              { data: 'Date' }, 
              { data: 'Agent' },
              { data: 'Type' },
              { data: 'OSD' },
              { data: '' } 
            ]
          });
  t.order( [ 1, 'desc' ] ).draw();

    // Enable pusher logging - don't include this in production
    Pusher.logToConsole = true;

    var pusher = new Pusher('<%= ENV["PUSHER_KEY"] %>', {
      cluster: '<%= ENV["PUSHER_CLUSTER"] %>',
      forceTLS: true
    });

    var channel = pusher.subscribe('dap');
    channel.bind('new-dap', function(data) {
      t.rows.add([{'Nature of Incident': data.noi, 'Date': data.date, 'Agent': data.agent, 'Type': data.wuname, 'OSD': data.osd, '': 'JUST ADDED'}]).draw();
    });

t.rows.add([<% @daps.each do |dap| %><% if dap.user.deleted_at.blank? %>{'Nature of Incident': '<%= dap.wunature.description %>', 'Date': '<%= dap.ddate %>', 'Agent': '<%= dap.user.full_name %>', 'Type': '<%= dap.writeup.name %>', 'OSD': '<%= dap.occurrence_since_dap %>', '': '<div class="btn-group"><%= link_to theme_icon_tag("eye"), dap, "data-toggle": "tooltip", title: "Show", class: "btn btn-link" %><%= link_to theme_icon_tag("pencil-alt"), edit_dap_path(dap), "data-toggle": "tooltip", title: "Edit", class: "btn btn-link" %><%= link_to theme_icon_tag("trash"), dap, "data-toggle": "tooltip", title: "Delete", data: { confirm: "Are you sure?" }, method: :delete, class: "btn btn-link" %></div>'},<% else %><% end %><% else %><% end %>]
  ).draw();
t.buttons().container()
    .appendTo( $('.col-sm-6:eq(0)', t.table().container() ) );
});
  </script>

<%= stylesheet_link_tag "pagination.css" %>
<% @title = "Listing Progressive Actions" %>

<% content_for :description do %>
  <% end %>

  <% content_for :actions do %>
    <%= link_to new_dap_path, class: 'btn btn-primary btn-large pull-right' do %>
      <%= fa_icon_tag "plus" %> Add PA
      <% end %>
      <% end %>

      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="card card-sheet sheet-condensed">
              <div class="mx-auto">
              </div>
              <div class="table-responsive">
              <table class="table table-striped table-hover" id="dapsTable">
                <thead>
                  <tr>
                        <th>Nature of Incident</th>
                        <th>Date</th>
                        <th>Agent</th>
                        <th>Type</th>
                        <th>OSD</th>
                      <th></th>
                  </tr>
                </thead>
                <tbody>

                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
<%= javascript_include_tag("https://cdn.datatables.net/select/1.3.0/js/dataTables.select.min.js") %>
