<!-- STYLESHEETS -->
<%= stylesheet_link_tag "user_dashboard.css" %>
<%= stylesheet_link_tag "slider.css" %>
<%= stylesheet_link_tag "pagination.css" %>
<!-- /STYLESHEETS -->

<!-- Page ready logic || Can't transfer over to a separate JS file because of the ERB. Eventually this will need to get switched to proper AJAX, but then we'll need to refactor the entire dispute modal -->
  <script>
  $(document).ready(function(t){

  // ENTRIES TABLE
  var t = $('#userEntryTable').DataTable({ 
          "pageLength": 5,
          select: true,
          columns: [ 
                { data: 'Name' }, 
                { data: 'Type' },
                { data: 'Date' }, 
                { data: 'Expires' },
                { data: 'Description' },
                { data: '' } 
              ]
            });
    t.draw();


  // So we should have done AJAX for all of these, but the dispute modal is a masterpiece of hacky engineering so don't right now unless you're prepared to look at it too. 
  t.rows.add(
    [<% @user_entry.each do |entry| %>{'Name': '<%= entry.agent.user.full_name %>', 'Type': '<%= entry.occurrence.name.truncate(15) %>', 'Date':'<%= entry.edate %>', 'Expires':'<%= entry.edate + 90.days %>', 'Description':'<%= entry.edesc.truncate(15) %>', '':''},<% else %><% end %>]
    ).draw();

  // ERROR TABLE
  var t = $('#userErrorTable').DataTable({ 
          "pageLength": 5,
          select: true,
          "order": [[5,'desc'],[0,'desc']],
          columns: [ 
                { data: 'Date' }, 
                { data: 'SO' },
                { data: 'Cost' }, 
                { data: 'Type' },
                { data: 'Description' },
                { data: 'Status' },
                { data: '' }
              ]
            });
    t.draw();


  // So we should have done AJAX for all of these, but the dispute modal is a masterpiece of hacky engineering so don't right now unless you're prepared to look at it too. 
  t.rows.add(
    [<% @err_logs.each do |err_log| %>{'Date': '<%= err_log.errdate %>', 'SO': '<%= err_log.serviceorder %>', 'Cost': '<%= err_log.err_cost %>', 'Type': '<%= err_log.err_name.errname %>', 'Description': '<%= err_log.errdesc.truncate(15) %>', 'Status': '<%= err_log.err_status.statusname %>', '': '<center><%= link_to "VIEW", users_modal_path(err_log.id),  {:remote => true, "data-toggle" => "modal", "data-target" => "#modal-error", class: "btn btn-primary btn-sm m-auto font-weight-bold"}%></center>' },<% else %><% end %>]
    ).draw();

  // DAPS TABLE
  var t = $('#userDapTable').DataTable({ 
          "pageLength": 5,
          select: true,
          columns: [ 
                { data: 'Name' }, 
                { data: 'Type' },
                { data: 'Date' }, 
                { data: 'Expires' },
                { data: 'Description' },
                { data: '' } 
              ]
            });
    t.draw();


  // So we should have done AJAX for all of these, but the dispute modal is a masterpiece of hacky engineering so don't right now unless you're prepared to look at it too. 
  t.rows.add(
    [<% @user_dap.each do |dap| %>{'Name': '<%= dap.user.full_name %>', 'Type': '<%= dap.writeup.name %>', 'Date':'<%= dap.ddate %>', 'Expires':'<%= dap.ddate + 90.days %>', 'Description':'<%= dap.description.truncate(15) %>', '':''},<% else %><% end %>]
    ).draw();

    // Incentives TABLE
  var t = $('#incentivesTable').DataTable({ 
          "pageLength": 5,
          select: true,
          'order': [0,'asc'],
          columns: [ 
                { data: 'Date' }, 
                { data: 'UPH' },
                { data: 'Occupancy' },
                { data: 'Turntime' },
                { data: 'Contracts' },
                { data: 'AHT' }
              ]
            });
    t.draw();


  // So we should have done AJAX for all of these, but the dispute modal is a masterpiece of hacky engineering so don't right now unless you're prepared to look at it too. 
  t.rows.add(
    [<% @incentives.each do |incentive| %>{'Date': '<%= (incentive.date).strftime("%m/%d/%Y") %>', 'UPH': '<%= incentive.uph %>', 'Occupancy':'<%= incentive.occupancy %>', 'Turntime':'<%= incentive.turntime %>', 'Contracts':'<%= incentive.contracts %>', 'AHT':'<%= incentive.aht %>'},<% else %><% end %>]
    ).draw();

  });


  </script>
<!-- /Page ready logic -->


<% content_for :no_page_header, true %>
<% content_for :js_libs, "modernizr gmaps flot chartjs demo-dashboard demo-chartjs demo-sparklines" %>


<body>

<!-- Cookie Modal used for incentive tracker.  -->
<script>
$(document).ready(function() {
    if (Cookies.get('morning_modal') == null) { // Disable this to make the incentive modal pop every time
        Cookies.set('morning_modal', 'yes', { expires: 1, path: '/' }); // Disable this to make the incentive modal pop every time
        $('#morningModal').modal('show');
    } // Disable this to make the incentive modal pop every time
    // highlight entry card
    if (<%= @user_entry_total_effective_monthly %> == <%= @incentive_settings.map {|m| m.attendance }.first.to_f %>) {
      $('#occurrence-modal').addClass('bg-warning text-white'); //Daily incentive tracker modal
      $('#occurrence-card-body').addClass('border-left-warning'); //Breakdown section card
    } else if (<%= @user_entry_total_effective_monthly %> > <%= @incentive_settings.map {|m| m.attendance }.first.to_f %>) {
      $('#occurrence-modal').addClass('bg-danger text-white'); //Daily incentive tracker modal
      $('#occurrence-card-body').addClass('border-left-danger'); //Breakdown section card
    } else {
      $('#occurrence-modal').addClass('bg-success text-white'); //Daily incentive tracker modal
      $('#occurrence-card-body').addClass('border-left-success'); //Breakdown section card
    }
    // highlight wu card
    if (<%= @user_writeup_written %> > 0) {
      $('#wu-modal').addClass('bg-danger text-white'); //Daily incentive tracker modal
      $('#wu-card-body').addClass('border-left-danger');  //Breakdown section card
    } else {
      $('#wu-modal').addClass('bg-success text-white'); //Daily incentive tracker modal
      $('#wu-card-body').addClass('border-left-success'); //Breakdown section card
    }
    // highlight uph card
    if (<%= number_with_precision(@uph, :precision => 1) %> < <%= @incentive_settings.map {|m| m.uph }.first.to_f %>) {
      $('#uph-modal').addClass('bg-warning text-white'); //Daily incentive tracker modal
      $('#uph-card-body').addClass('border-left-warning'); //Breakdown section card
    } else {
      $('#uph-modal').addClass('bg-success text-white'); //Daily incentive tracker modal
      $('#uph-card-body').addClass('border-left-success'); //Breakdown section card
    }
    // highlight occ card
    if (<%= number_with_precision(@occ, :precision => 1) %> < <%= @incentive_settings.map {|m| m.occupancy }.first.to_f %>) {
      $('#occupancy-modal').addClass('bg-warning text-white'); //Daily incentive tracker modal
      $('#occupancy-card-body').addClass('border-left-warning'); //Breakdown section card
    } else {
      $('#occupancy-modal').addClass('bg-success text-white'); //Daily incentive tracker modal
      $('#occupancy-card-body').addClass('border-left-success'); //Breakdown section card
    }
    // highlight err card
    if (<%= @err_logs_count %> > <%= @incentive_settings.map {|m| m.error }.first.to_f %>) {
      $('#error-modal').addClass('bg-danger text-white'); //Daily incentive tracker modal
      $('#error-card-body').addClass('border-left-danger'); //Breakdown section card
    } else {
      $('#error-modal').addClass('bg-success text-white'); //Daily incentive tracker modal
      $('#error-card-body').addClass('border-left-success'); //Breakdown section card
    }   
    // highlight error_amount card
    if (<%= @error_amount %> > <%= @incentive_settings.map {|m| m.error_amount }.first.to_f %>) {
      $('#error-cost-card-body').addClass('border-left-danger'); //Breakdown section card
    } else {
      $('#error-cost-card-body').addClass('border-left-success'); //Breakdown section card
    }
    // highlight aht card
    if (<%= @aht %> > <%= @incentive_settings.map {|m| m.aht }.first.to_f %>) {
      $('#aht-card-body').addClass('border-left-danger'); //Breakdown section card
    } else {
      $('#aht-card-body').addClass('border-left-success'); //Breakdown section card
    }
    // highlight turntime card
    if (<%= @turntime %> > <%= @incentive_settings.map {|m| m.turntime }.first.to_f %>) {
      $('#turntime-card-body').addClass('border-left-danger'); //Breakdown section card
      $('#turntime-modal').addClass('bg-danger text-white'); //Daily incentive tracker modal
    } else {
      $('#turntime-card-body').addClass('border-left-success'); //Breakdown section card
      $('#turntime-modal').addClass('bg-success text-white'); //Daily incentive tracker modal
    }
    // highlight contracts card
    if (<%= @contracts %> > <%= @incentive_settings.map {|m| m.contracts }.first.to_f %>) {
      $('#contracts-card-body').addClass('border-left-danger'); //Breakdown section card
      $('#contracts-modal').addClass('bg-danger text-white'); //Daily incentive tracker modal
    } else {
      $('#contracts-card-body').addClass('border-left-success'); //Breakdown section card
      $('#contracts-modal').addClass('bg-success text-white'); //Daily incentive tracker modal
    }
});

// quick action sidebar logic
$(document).ready(function(){
  $("#menu-toggle").click(function(e){
    e.preventDefault();
    $("#wrapper").toggleClass("menuDisplayed");
    $(".slider").toggleClass("menu-slide");
    $('#sidebar-wrapper').toggleClass('sidebar-wrapper-open')
  });
});
</script>

<!-- Quick action sidebar || Should only be available to ADMIN. Need to clean it up more to restrict individual permissions later. Possible implement CANCANCAN -->
  <% if current_user.admin == true %>
    <div id="wrapper">
      <div id="sidebar-wrapper">
        <div class="container-fluid">
          <div class="row">
            <div class="col-12">
              <center><%= image_tag("newleaf logo leaf.png") %></center>
            </div>
          </div>
          <hr>
          <div class="row">
            <div class="col-12 p-0">
              <div class="nav flex-column nav-pills w-100" id="wrapper-pills-tab" role="tablist" aria-orientation="vertical">
                <a style="border-radius: 0 !important;" class="mx-3 font-weight-bold nav-link active" id="wrapper-pills-error-tab" data-toggle="pill" href="#wrapper-pills-error" role="tab" aria-controls="wrapper-pills-error" aria-selected="true">IMPROVEMENT LOG</a>
                <a style="border-radius: 0 !important;" class="mx-3 font-weight-bold nav-link" id="wrapper-pills-entry-tab" data-toggle="pill" href="#wrapper-pills-entry" role="tab" aria-controls="wrapper-pills-entry" aria-selected="false">OCCURRENCE LOG</a>
                <a style="border-radius: 0 !important;" class="mx-3 font-weight-bold nav-link" id="wrapper-pills-dap-tab" data-toggle="pill" href="#wrapper-pills-dap" role="tab" aria-controls="wrapper-pills-dap" aria-selected="false">PROGRESSIVE LOG</a>
              </div>
            </div>
          </div>
          <hr>
          <div class="row mx-1">
            <div class="col-12 p-0">
              <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="wrapper-pills-error" role="tabpanel" aria-labelledby="wrapper-pills-error-tab" style="">
                  <div class="container p-1 bg-white" style="height:375px;overflow-y: scroll;">
                    <%= render "err_logs/form" %>
                  </div>
                </div>
                <div class="tab-pane fade" id="wrapper-pills-entry" role="tabpanel" aria-labelledby="wrapper-pills-entry-tab">
                  <div class="container p-1 bg-white" style="height:375px;overflow-y: scroll;">
                    <%= render "entries/form" %>
                  </div>
                </div>
                <div class="tab-pane fade" id="wrapper-pills-dap" role="tabpanel" aria-labelledby="wrapper-pills-dap-tab">
                  <div class="container p-1 bg-white" style="height:375px;overflow-y: scroll;">
                    <%= render "daps/form" %>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Floating tab on the left hand side -->
    <div class="bg-primary slider" style=""><a href="#" class="font-weight-bold text-white btn btn-link px-auto pl-1" id="menu-toggle" style="writing-mode: vertical-rl;text-orientation: sideways;font-size: 12px"><%= fa_icon_tag("plus") %> QUICK ACTION</a></div>
  <% end %>
<!-- /Quick action sidebar -->


<!-- Incentives breakdown modal -->
<div class="modal fade" id="incentivesModal" tabindex="-1" role="dialog" aria-labelledby="incentivesModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="font-weight-bold" id="incentivesModalLabel">All Incentives</h5>
        <button type="button" class="btn btn-sm" data-dismiss="modal" aria-label="Close">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="table-responsive">
          <table class="table table-striped table-hover" id="incentivesTable">
            <thead>
              <tr>
                <th>Date</th>
                <th>UPH</th>
                <th>Occupancy</th>
                <th>Turntime</th>
                <th>Contracts</th>
                <th>AHT</th>
              </tr>
            </thead>
            <tbody>
              <!-- content generated by jquery -->
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary pull-right" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- /Incentives breakdown modal -->
<!-- INCENTIVES MODAL -->
<div class="modal fade" id="morningModal" tabindex="-1" role="dialog" aria-labelledby="morningModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
    <div class="modal-content rounded">
      <div class="bg-light m-3 rounded float-inset">
        <div class="row pl-3 pr-3 pb-1 pt-3">
          <div class="col d-flex align-items-stretch">
            <div class="card fancy-fade float" style="width: 12rem;"> 
            <!-- Fancy Fade goes from fancy-fade to fancy-fade-4. If they aren't dropping in order, may need to play with it.  -->
              <div class="card-header m-auto" id="occurrence-modal">
                <i style="font-size: 6rem;" class="m-auto pt-4 fa fa-calendar-times-o"></i>
              </div>
              <!-- In the card body, there's 'advice' that will need to be played with during production. -->
              <div class="card-body">
                <center><h6 class="font-weight-bold text-dark text-uppercase">Occurrences</h6></center>
                <p class="card-text text-center"><%if @user_entry_total_effective_monthly == @incentive_settings.map {|m| m.attendance }.first.to_f %>You are at capacity for occurrences this month with <u><%= @user_entry_total_effective_monthly %></u>. Watch your attendance for the remainder of the month!<% elsif @user_entry_total_effective_monthly > @incentive_settings.map {|m| m.attendance }.first.to_f %>Unfortunately, you have missed the mark on your attendance this month. Please be sure to work on that for the next month!<% else %>Fantastic job!<% end %></p>
              </div>
            </div>
          </div>
          <div class="col d-flex align-items-stretch">
            <div class="card fancy-fade-1 float" style="width: 12rem;">
            <!-- Fancy Fade goes from fancy-fade to fancy-fade-4. If they aren't dropping in order, may need to play with it.  -->  
              <div class="card-header m-auto" id="wu-modal">
                <i style="font-size: 6rem;" class="m-auto pt-4 fa fa-wpforms "></i>
              </div>
              <!-- In the card body, there's 'advice' that will need to be played with during production. -->
              <div class="card-body">
                <center><h6 class="font-weight-bold text-dark text-uppercase">PROGRESSIVE LOGS</h6></center>
                <p class="card-text text-center"><% if @user_writeup_written >= 1 %>Unfortunately your progressive action is still active this month. Your last progressive action is due to drop off on <%= (@user_dap.map {|d| d.ddate }.first + 90.days).strftime('%m/%d/%Y') %>.<% else %>Great Job!<% end %></p>
              </div>
            </div>
          </div>
          <% if (@incentive_settings.map {|m| m.uph }.first.to_f) > 0 %> <!-- probably needs to be set to nil -->
          <div class="col d-flex align-items-stretch">
            <div class="card fancy-fade-2 float" style="width: 12rem;">
            <!-- Fancy Fade goes from fancy-fade to fancy-fade-4. If they aren't dropping in order, may need to play with it.  -->  
              <div class="card-header m-auto" id="uph-modal">
                <i style="font-size: 6rem" class="m-auto pt-4 fa fa-hashtag "></i>
              </div>
              <!-- In the card body, there's 'advice' that will need to be played with during production. -->
              <div class="card-body">
                <center><h6 class="font-weight-bold text-dark text-uppercase">UPH</h6></center>
                <p class="card-text text-center"><% if @uph.to_f < @incentive_settings.map {|m| m.uph }.first.to_f %>Looks like your UPH needs work to reach the goal of 7.5 units/hour. Work on reducing your handle time.<% else %>Keep it up!<% end %></p>
              </div>
            </div>
          </div>
          <% end %>
          <% if (@incentive_settings.map {|m| m.occupancy }.first.to_f) > 0 %>
          <div class="col d-flex align-items-stretch">
            <div class="card fancy-fade-3 float" style="width: 12rem;">
            <!-- Fancy Fade goes from fancy-fade to fancy-fade-4. If they aren't dropping in order, may need to play with it.  -->  
              <div class="card-header m-auto" id="occupancy-modal">
                <i style="font-size: 6rem" class="m-auto pt-4 fa fa-clock-o "></i>
              </div>
              <!-- In the card body, there's 'advice' that will need to be played with during production. -->
              <div class="card-body">
                <center><h6 class="font-weight-bold text-dark text-uppercase">Occupancy</h6></center>
                <p class="card-text text-center"><% if @occ.to_f >= @incentive_settings.map {|m| m.occupancy }.first.to_f %> Great work, just be sure you do not exceed the 100% threshold by only working on one item at a time. <% elsif @occ.to_f < @incentive_settings.map {|m| m.occupancy }.first.to_f %>Need to keep working on this. Speak to a lead or manager to see how.<% else %>Great, keep it between 90%-100%!<% end %></p>
              </div>
            </div>
          </div>
          <% end %>
          <% if @incentive_settings.map {|m| m.turntime }.first.to_f > 0 %>
          <div class="col d-flex align-items-stretch">
            <div class="card fancy-fade-2 float" style="width: 12rem;">
            <!-- Fancy Fade goes from fancy-fade to fancy-fade-4. If they aren't dropping in order, may need to play with it.  -->  
              <div class="card-header m-auto" id="turntime-modal">
                <i style="font-size: 6rem" class="m-auto pt-4 fa fa-exclamation-triangle "></i>
              </div>
              <!-- In the card body, there's 'advice' that will need to be played with during production. -->
              <div class="card-body">
                <center><h6 class="font-weight-bold text-dark text-uppercase">TURNTIME</h6></center>
                <p class="card-text text-center"><% if @turntime.to_f > @incentive_settings.map {|m| m.turntime }.first.to_f %>Unfortunately the turntime on service orders is too high. Keep working!<% else %>Don't lose momentum!<% end %></p>
              </div>
            </div>
          </div>
          <% end %>
          <% if @incentive_settings.map {|m| m.contracts }.first.to_f > 0 %>
          <div class="col d-flex align-items-stretch">
            <div class="card fancy-fade-3 float" style="width: 12rem;">
            <!-- Fancy Fade goes from fancy-fade to fancy-fade-4. If they aren't dropping in order, may need to play with it.  -->  
              <div class="card-header m-auto" id="contracts-modal">
                <i style="font-size: 6rem" class="m-auto pt-4 fa fa-exclamation-triangle "></i>
              </div>
              <!-- In the card body, there's 'advice' that will need to be played with during production. -->
              <div class="card-body">
                <center><h6 class="font-weight-bold text-dark text-uppercase">CONTRACTS</h6></center>
                <p class="card-text text-center"><% if @contracts.to_f < @incentive_settings.map {|m| m.contracts }.first.to_f %>Keep working on recruitment!<% else %>Don't lose momentum!<% end %></p>
              </div>
            </div>
          </div>
          <% end %>
          <% if (@incentive_settings.map {|m| m.error }.first.to_f) > 0 %>
          <div class="col d-flex align-items-stretch">
            <div class="card fancy-fade-4 float" style="width: 12rem;">
            <!-- Fancy Fade goes from fancy-fade to fancy-fade-4. If they aren't dropping in order, may need to play with it.  -->  
              <div class="card-header m-auto" id="error-modal">
                <i style="font-size: 6rem" class="m-auto pt-4 fa fa-exclamation-triangle "></i>
              </div>
              <!-- In the card body, there's 'advice' that will need to be played with during production. -->
              <div class="card-body">
                <center><h6 class="font-weight-bold text-dark text-uppercase">IMPROVEMENT LOGS</h6></center>
                <p class="card-text text-center"><% if @err_logs_count > @incentive_settings.map {|m| m.error }.first.to_f %>Unfortunately, your errors are a bit too much this month. Work on accuracy for next month!<% else %>Don't lose momentum!<% end %></p>
              </div>
            </div>
          </div>
          <% end %>
        </div>
      </div>
      <div class="row">
        <p class="font-weight-bold ml-5 mr-5 mb-3 text-center">As a reminder, all data is subject to final checks before the incentive is tendered. This portal is to be used as a reference guide and not as a definitive source for eligibility.</p>
      </div>
      <div class="m-auto pb-4"><button class="btn btn-primary font-weight-bold text-white float-active-sm" data-dismiss="modal">AGREE & ENTER</button></div>
      <span class="font-weight-bold text-light pr-1 pb-1" style="position:absolute;bottom:0px !important;left:5px !important;font-size: 10px"><%= current_user.full_name %></span>
      <span class="font-weight-bold text-light pr-1 pb-1" style="position:absolute;bottom:0px !important;right:5px !important;font-size: 10px"><%= Time.now %></span>
    </div>
  </div>
</div>
<!-- /END OF INCENTIVES MODAL -->

<!-- Dispute Modal -->
<div class="modal fade" id="modal-error" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content" id="modal-dialog">

    </div>
  </div>
</div>
<!-- /Dispute Modal -->
<!-- Body -->

<section class="px-3 pt-5 pb-3 mb-3 d-flex flex-column float-inset" style="background-color: #eeeeee !important">
  <div class="container-fluid">
    <div class="row equal-cols">
      <div class="col-10 col-md-3">
        <div class="card float" >
          <div class="card-header">
            <h6 class="mr-auto">Breakdown </h6><button type="button" onclick="popIncentiveModal()" class="btn btn-sm btn-white m-0 p-1 font-weight-bold"><i class="fa fa-table pull-right m-auto"></i>
          </div>
          <div class="card-body p-0 m-0" style="height: 500px;overflow-y: scroll">
            <ul class="list-group">
              <li class="list-group-item border-left" style="border-left-width: 10px !important;border-radius: 0;"  id="wu-card-body">
                <div class="row">
                  <div class="col-12">
                    <u>Progressive Logs</u>
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">
                    <h4 class="m-0 dap-count"><%= @user_writeup_written %> <small>active</small></h4>
                  </div>
                  <div class="col-4 text-right">
                    <i class="fa fa-wpforms pt-3"></i>
                  </div>
                </div>
              </li>
              <li class="list-group-item border-left" style="border-left-width: 10px !important;border-radius: 0;" id="occurrence-card-body">
                <u>Occurrences</u>
                <ul class="nav nav-pills pull-right" id="arrow-tab-occurrences" role="tablist">
                  <li class="nav-item mr-1">
                    <a class="p-0" id="pills-occurrence-monthly-tab" data-toggle="pill" href="#pills-occurrence-monthly" role="tab" aria-controls="pills-occurrence-monthly" aria-selected="true"><h6 class=" font-weight-bold"><i class="fa fa-chevron-left" style="color: #707070 !important"></i></h6></a>
                  </li>
                  <li class="nav-item ml-1">
                    <a class="p-0" id="pills-occurrence-total-tab" data-toggle="pill" href="#pills-occurrence-total" role="tab" aria-controls="pills-occurrence-total" aria-selected="false"><h6 class=" font-weight-bold"><i class="fa fa-chevron-right" style="color: #707070 !important"></i></h6></a>
                  </li>
                </ul>
                <br>
                <div class="tab-content" id="pills-tabContent">
                  <div class="tab-pane fade show active" id="pills-occurrence-monthly" role="tabpanel" aria-labelledby="pills-occurrence-monthly-tab">
                    <div class="row">
                      <div class="col-8">
                        <h4 class="m-0 entry-count"><%= @user_entry_total_effective_monthly %> <small>monthly</small></h4>
                      </div>
                      <div class="col-4">
                        <i class="fa fa-calendar-times-o pull-right pt-3"></i>
                      </div>
                    </div>
                  </div>
                  <div class="tab-pane" id="pills-occurrence-total" role="tabpanel" aria-labelledby="pills-occurrence-total-tab">
                    <div class="row">
                      <div class="col-8">
                        <h4 class="m-0 entry-count"><%= @user_entry_total_effective %> <small>total</small></h4>
                      </div>
                      <div class="col-4">
                        <i class="fa fa-calendar-times-o pull-right pt-3"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
              <li class="list-group-item border-left" style="border-left-width: 10px !important;border-radius: 0;"  id="error-card-body">
                <u>Improvement Logs</u>
                <ul class="nav nav-pills pull-right" id="arrow-tab" role="tablist">
                  <li class="nav-item mr-1">
                    <button class="btn btn-link btn-style left m-0 p-0" type="button" style="font-size: 16px !important"><i class="fa fa-chevron-left" style="color: #707070 !important"></i></button>
                  </li>
                  <li class="nav-item ml-1">
                    <button class="btn btn-link btn-style right m-0 p-0" type="button" style="font-size: 16px !important"><i class='fa fa-chevron-right' style="color: #707070 !important"></i></button>
                  </li>
                </ul>
                <div hidden>
                  <ul class="nav nav-pills pull-right justify-items-between" id="pills-tab" role="tablist">
                    <li class="nav-item active mr-1">
                      <a class="p-0" id="pills-error-monthly-tab" data-toggle="pill" href="#pills-error-monthly" role="tab" aria-controls="pills-error-monthly" aria-selected="true"><h6></h6></a>
                    </li>
                    <li class="nav-item ml-1">
                      <a class="p-0" id="pills-error-disputed-tab" data-toggle="pill" href="#pills-error-disputed" role="tab" aria-controls="pills-error-disputed" aria-selected="false"><h6 class=" font-weight-bold text-dark"><i class="fa fa-chevron-right"></i></h6></a>
                    </li>
                    <li class="nav-item ml-1">
                      <a class="p-0" id="pills-error-pending-tab" data-toggle="pill" href="#pills-error-pending" role="tab" aria-controls="pills-error-pending" aria-selected="false"><h6 class=" font-weight-bold text-dark"><i class="fa fa-chevron-right"></i></h6></a>
                    </li>
                  </ul>
                </div>
                <br>
                <div class="tab-content" id="pills-tabContent">
                  <div class="tab-pane fade show active" id="pills-error-monthly" role="tabpanel" aria-labelledby="pills-error-monthly-tab">
                    <div class="row">
                      <div class="col-8">
                        <h4 class="m-0 entry-count"><%= @err_logs_count %> <small>active</small></h4>
                      </div>
                      <div class="col-4">
                        <i class="fa fa-calendar-times-o pull-right pt-3"></i>
                      </div>
                    </div>
                  </div>
                  <div class="tab-pane" id="pills-error-disputed" role="tabpanel" aria-labelledby="pills-error-disputed-tab">
                    <div class="row">
                      <div class="col-8">
                        <h4 class="m-0 entry-count"><%= @err_logs_dispute %> <small>disputed</small></h4>
                      </div>
                      <div class="col-4">
                        <i class="fa fa-calendar-times-o pull-right pt-3"></i>
                      </div>
                    </div>
                  </div>
                  <div class="tab-pane" id="pills-error-pending" role="tabpanel" aria-labelledby="pills-error-pending-tab">
                    <div class="row">
                      <div class="col-8">
                        <h4 class="m-0 entry-count"><%= @err_logs_pending %> <small>pending</small></h4>
                      </div>
                      <div class="col-4">
                        <i class="fa fa-calendar-times-o pull-right pt-3"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </li>
              <li class="list-group-item border-left" style="border-left-width: 10px !important;border-radius: 0;"  id="error-cost-card-body">
                <div class="row">
                  <div class="col-12">
                    <u>Improvement Cost</u>
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">
                    <h4 class="m-0">$<%= number_with_precision(@error_amount, :precision => 1) %> <small>total</small></h4>
                  </div>
                  <div class="col-4 text-right">
                    <i class="fa fa-clock-o pt-3"></i>
                  </div>
                </div>
              </li>
              
              <li class="list-group-item border-left" style="border-left-width: 10px !important;border-radius: 0;"  id="uph-card-body">
                <div class="row">
                  <div class="col-12">
                    <u>UPH</u>
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">
                    <h4 class="m-0"><%= number_with_precision(@uph, :precision => 1) %> <small>monthly</small></h4>
                  </div>
                  <div class="col-4 text-right">
                    <i class="fa fa-hashtag pt-3"></i>
                  </div>
                </div>
              </li>
              <li class="list-group-item border-left" style="border-left-width: 10px !important;border-radius: 0;"  id="occupancy-card-body">
                <div class="row">
                  <div class="col-12">
                    <u>Occupancy</u>
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">
                    <h4 class="m-0"><%= number_with_precision(@occ, :precision => 1) %>% <small>monthly</small></h4>
                  </div>
                  <div class="col-4 text-right">
                    <i class="fa fa-clock-o pt-3"></i>
                  </div>
                </div>
              </li>
              <li class="list-group-item border-left" style="border-left-width: 10px !important;border-radius: 0;"  id="aht-card-body">
                <div class="row">
                  <div class="col-12">
                    <u>AHT</u>
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">
                    <h4 class="m-0"><%= number_with_precision(@aht, :precision => 1) %> <small>monthly</small></h4>
                  </div>
                  <div class="col-4 text-right">
                    <i class="fa fa-clock-o pt-3"></i>
                  </div>
                </div>
              </li>
              
              <li class="list-group-item border-left" style="border-left-width: 10px !important;border-radius: 0;"  id="turntime-card-body">
                <div class="row">
                  <div class="col-12">
                    <u>Turntime</u>
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">
                    <h4 class="m-0"><%= number_with_precision(@turntime, :precision => 1) %> <small>monthly</small></h4>
                  </div>
                  <div class="col-4 text-right">
                    <i class="fa fa-clock-o pt-3"></i>
                  </div>
                </div>
              </li>
              <li class="list-group-item border-left" style="border-left-width: 10px !important;border-radius: 0;"  id="contracts-card-body">
                <div class="row">
                  <div class="col-12">
                    <u>Contracts</u>
                  </div>
                </div>
                <div class="row">
                  <div class="col-8">
                    <h4 class="m-0"><%= @contracts %> <small>monthly</small></h4>
                  </div>
                  <div class="col-4 text-right">
                    <i class="fa fa-clock-o pt-3"></i>
                  </div>
                </div>
              </li>
            </ul>
          </div>
          <script>
            // couldn't figure out the best way to use two buttons for 3 page pagination so this is it.
          $(".btn-style").click(function () {
              var target = $("#pills-tab li.active");
              var sibbling;
              if ($(this).hasClass('right')) {
                  sibbling = target.next();
              } else {
                  sibbling = target.prev();
              }
              if (sibbling.is("li")) {
                  target.removeClass("active")
                  sibbling.addClass("active").children("a").tab("show");
              }
          });

          function popIncentiveModal(){
            $('#incentivesModal').modal('show');
          }
          </script>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="card float" style="background-color: #ffffff !important">
          <div class="card-header d-flex align-items-center">
            <h6 class="mr-auto">Agent Stats</h6>
            <div class="dropdown">
              <button class="btn btn-sm btn-primary dropdown-toggle font-weight-bold" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                DATE RANGE
              </button>
              <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <button type="button" class="dropdown-item" id="incentiveWeekButton">7 Day</button>
                <button type="button" class="dropdown-item" id="incentiveMonthButton">Monthly</button>
              </div>
            </div>
          </div>
          <div class="card-body" style="height: 500px">
            <canvas id="statChart" width="200" height="125"></canvas>
            
          </div>
        </div>
      </div>

      <div class="col-3">
        <!-- RECENT ACTIVITY TABLE -->
        <div class="card inspectable float">
          <!-- component-title: Timeline Card -->
          <div class="card-header">
            <h6>RECENT ACTIVITY</h6>
          </div>
          <div class="card-body p-0 m-0" style="height: 500px">
            <div class="timeline">
              <ul class="left-timeline">
                <% @user_entry.each do |entry| %>
                  <li class="timeline-item">
                    <time class=''>
                      <strong>
                        <%= entry.occurrence.name %> - <%= entry.occurrence.ovalue %>
                      </strong>
                    </time>
                    <div class="activity-text">
                      <strong><%= entry.edate.strftime("%m/%d/%Y") %></strong>
                      <small class="text-muted">EXPIRES: <%= (entry.edate + 90.days).strftime("%m/%d/%Y") %></small>
                    </div>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
        <!-- /RECENT ACTIVITY TABLE-->
      </div>
    </div>
  </div>
</section>


<nav>
  <div class="row">
    <div class="col-6">
      <div class="nav nav-tabs ml-5" id="nav-pills" role="tablist">
        <button class="btn btn-primary active font-weight-bold table-select" style="border-radius: calc(0.25rem - 1px) 0 0 calc(0.25rem - 1px);width:175px" id="pills-occurrence-tab" data-toggle="pill" href="#pills-occurrence" role="tab" aria-controls="pills-occurrence" aria-selected="true" type="button" name="occurrence"><i class="fa fa-calendar-times-o "></i> OCCURRENCES</button>
        <button class="btn btn-primary font-weight-bold table-select" style="border-radius: 0px;width:175px" id="pills-dap-tab" data-toggle="pill" href="#pills-dap" role="tab" aria-controls="pills-dap" aria-selected="false" type="button" name="progressive action"><i class="fa fa-wpforms "></i> PROGRESSIVES</button>
        <button class="btn btn-primary font-weight-bold table-select" style="border-radius: 0 calc(0.25rem - 1px) calc(0.25rem - 1px) 0;width:175px" id="pills-error-tab" data-toggle="pill" href="#pills-error" role="tab" aria-controls="pills-error" aria-selected="false" type="button" name="improvement log"><i class="fa fa-exclamation-triangle "></i> IMPROVEMENTS</button>
      </div>
    </div>
    <div class="col-6">
      <div class="pull-right pr-5">
        <h3 class="font-weight-bold" id="table-title"><span class="text-uppercase" name="table-title-current-anchor" id="table-title-current">OCCURRENCE</span> BREAKDOWN</h3>
      </div>
    </div>
  </div>
</nav>


<div class="container-fluid p-4 float-inset" style="height: 450px;background-color: #eeeeee !important;">
  <div class="row pt-3 px-3">
    <div class="col-12 ">
      <div class="row">
        <div class="col-12">
          <!-- OCCURRENCE TABLE -->
          <div class="tab-content" id="pills-tabContent">
            <div class="tab-pane fade show active" id="pills-occurrence" role="tabpanel" aria-labelledby="pills-occurrence-tab">
              <div class="card card-sheet sheet-condensed inspectable float p-1">
                <div class="table-responsive" >
                  <table class="table table-hover table-striped" id="userEntryTable">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Date</th>
                        <th>Expires</th>
                        <th>Description</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- content generated by jquery -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="pills-dap" role="tabpanel" aria-labelledby="pills-dap-tab">
              <div class="card inspectable float p-1">      
                <div class="table-responsive">
                  <table class="table table-hover table-striped" id="userDapTable">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Date</th>
                        <th>Expires</th>
                        <th>Description</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- content generated by jquery -->
                    </tbody>
                  </table>
                </div>
              </div>              
            </div>
            <div class="tab-pane fade" id="pills-error" role="tabpanel" aria-labelledby="pills-error-tab">
              <div class="card inspectable float p-1">      
                <div class="table-responsive">
                  <table class="table table-striped table-hover" id="userErrorTable">
                    <thead>
                      <tr>
                        <th>Date</th>
                        <th>SO</th>
                        <th>Cost</th>
                        <th>Type</th>
                        <th>Description</th>
                        <th>Status</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- content generated by jquery -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Javascripts -->
  <script>
    // Change the table name when you select a button. Nothing fancy.
    $('.table-select').click(function(){ 
      $('#table-title-current').text($(this).attr('name'));
    })


    // If you're reading this, you're probably familiar with how Chart.js works so I wont dive into it much.
    var chart_labels = <%= raw @agent_chart_labels_effective %>; 
    var uph_data = <%= @agent_chart_data_effective %>;
    var occ_data = <%= @agent_chart_data_effective_occupancy %>;
    var aht_data = <%= @agent_chart_data_effective_aht %>;
    var dataset_label = "UPH";
    var chart_type = 'line';
    var ctx = document.getElementById("statChart").getContext('2d');
    var config = {
        type: 'bar',
        data: {
            labels: chart_labels,
            datasets: [{
                label: "UPH",
                yAxisID: 'B',
                data: uph_data,
                backgroundColor: 'rgb(0,100,0, 0.7)',
                borderColor: '#373737',
                borderWidth: 1,
                order: 2
            },{
                label: "AHT",
                yAxisID: 'B',
                data: aht_data,
                backgroundColor: 'rgb(51,131,51, 0.7)',
                borderColor: '#373737',
                borderWidth: 1,
                order: 3
            },{
                label: 'OCC',
                yAxisID: 'A',
                data: occ_data,
                backgroundColor: 'rgb(152,251,152,0.9)',
                borderColor: '#373737',
                borderWidth: 1,
                type: 'line',
                order: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                yAxes: [{ // For occupancy
                  id: 'A',
                  type: 'linear',
                  position: 'right',
                  ticks: {
                      min: 50,
                      max: 150,
                      callback: function(value, index, values) {
                          return value + '%';
                      }
                  }
                }, { // For UPH
                  id: 'B',
                  type: 'linear',
                  position: 'left',
                  ticks: {
                      min: 0,
                      max: 20
                  }
                }]
            }
        }
    };
    var stat_chart = new Chart(ctx, config);
    $("#incentiveWeekButton").click(function() {
      var chart_labels = <%= raw @agent_chart_labels_effective %>; 
      var uph_data = <%= @agent_chart_data_effective %>;
      var occ_data = <%= @agent_chart_data_effective_occupancy %>;
      var aht_data = <%= @agent_chart_data_effective_aht %>;
        var data = stat_chart.config.data;
        data.datasets[0].data = uph_data;
        data.datasets[2].data = occ_data;
        data.datasets[1].data = aht_data;
        data.labels = chart_labels;
        stat_chart.update();
    });
    $("#incentiveMonthButton").click(function() {
      var chart_labels = <%= raw @agent_chart_labels_effective_month %>; 
      var uph_data = <%= @agent_chart_data_effective_month %>;
      var occ_data = <%= @agent_chart_data_effective_occupancy_month %>;
      var aht_data = <%= @agent_chart_data_effective_aht_month %>;
        var data = stat_chart.config.data;
        data.datasets[0].data = uph_data;
        data.datasets[2].data = occ_data;
        data.datasets[1].data = aht_data;
        data.labels = chart_labels;
        stat_chart.update();
    });

  </script>
</body>