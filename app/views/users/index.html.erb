<% content_for :description do %>
  <% end %>


<div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="card card-sheet sheet-condensed">
              <div class="table-responsive">
              <table class="table table-striped table-hover table-sm-responsive">
                <thead>
                  <tr>
                  						  <th>ID</th>
                                          <th><%= link_to "Agent", :sort => "users.first_name asc" %></th>
                                          <th><%= link_to "Department", :sort => "departments.name asc" %></th>
                                          <th>TAO</th>
                                          <th>TAW</th>
                                          <th>OSW</th>
                                          <th>AR?</th>
                                          <th><!-- Action Button Column --></th>
                  </tr>
                </thead>
                <tbody>
                <% @users.each do |user| %>

                  <tr>
                  						  <td><%= user.id.truncate(15) %>
                                          <td><%= user.full_name.truncate(15) %></td>
                                          <td><%= user.department.name.truncate(15) %></td>
                                          <td><% if user.agent.entries.map {|a| a.total_effective_occurrence.to_f}.first.to_f > 2.5 then %>
                                                <span class="text-danger"><%= user.agent.entries.map {|a| a.total_effective_occurrence.to_f}.first %></span>
                                              <% else %>
                                                <span><%= user.agent.entries.map {|a| a.total_effective_occurrence.to_f}.first %></span>
                                              <% end %>  
                                          </td>
                                          <td><% if user.daps.map.count {|m| m.total_active_writeup} > 0 then %>
                                                <span class="text-danger"><%= user.daps.map.count {|m| m.total_active_writeup} %></span>
                                              <% else %>
                                                <span><%= user.daps.map.count {|m| m.total_active_writeup} %></span> 
                                              <% end %> 
                                          </td>
                                          <td><% if user.daps.map {|m| m.occurrence_since_dap}.first.to_f >= 1.0 then %>
                                                <span class="text-danger"><%= user.daps.map{|m| m.occurrence_since_dap}.first %></span>
                                              <% else %>
                                                <span><%= user.daps.map{|m| m.occurrence_since_dap}.first %></span>
                                              <% end %>
                                          </td>
                                          <td><% if user.daps.map {|m| m.occurrence_since_dap}.first.to_f >= 1.0 || user.agent.entries.map {|a| a.total_effective_occurrence.to_f}.first.to_f > 2.5 && user.daps.map.count {|m| m.total_active_writeup} == 0 then %>
                                                <span class="text-danger"><%= fa_icon_tag("times-circle-o") %></span>
                                              <% else %>
                                                <span class="text-success"><%= fa_icon_tag("check-circle-o") %></span>
                                              <% end %>  
                                          </td>
                                        <td class="actions text-right">
                      <div class="btn-group">
                        <%= link_to theme_icon_tag("eye"), user, 'data-toggle': 'tooltip', title: 'Show', class: "btn btn-link" %>
                        <%= link_to theme_icon_tag("pencil-alt"), edit_user_path(user), 'data-toggle': 'tooltip', title: 'Edit', class: "btn btn-link" %>
                        <%= link_to theme_icon_tag("trash"), user, 'data-toggle': 'tooltip', title: 'Delete',
                        data: { confirm: 'Are you sure?' }, method: :delete, class: 'btn btn-link' %>
                      </div>
                      </td>
                    </tr>
                    <% end %>
                    </tbody>

                  </table>
                </div>