  <script>

$(document).ready(function(t){
var t = $('#agentTable').DataTable({ 
        "pageLength": 10,
        select: true,
        dom: 'Bfrtip',
        buttons: [
          'copy', 'csvHtml5'
          ], 
        columns: [ 
              { data: 'Full Name' }, 
              { data: 'Email' },
              { data: 'Department' }, 
              { data: 'TAO' },
              { data: 'TAW' },
              { data: 'OSAW' },
              { data: 'OSW' },
              { data: 'AR' },
              { data: '' } 
            ]
          });
  t.draw();



t.rows.add(
  [<% @agents.each do |agent| -%><% if agent.user.deleted_at.nil? && agent.user.has_role?(:agent) || agent.user.has_role?(:lead) || agent.user.has_role?(:reporting) %>{'Full Name': '<%= agent.user.full_name %>', 'Email': '<%= agent.user.email %>', 'Department': '<%= agent.department.name.truncate(15) %>', 'TAO': '<% if agent.entries.map {|a| a.total_effective_occurrence.to_f}.first.to_f > 2.5 then %><span class="text-danger"><%= agent.entries.map {|a| a.total_effective_occurrence.to_f}.first %></span><% else %><span><%= agent.entries.map {|a| a.total_effective_occurrence.to_f}.first %></span><% end %>', 'TAW': '<% if agent.user.daps.map {|m| m.total_active_writeup.to_f}.join(' ').to_f > 0 then %><span class="text-danger"><%= agent.user.daps.map {|m| m.total_active_writeup.to_f}.join(' ').to_i %></span><% else %><span><%= agent.user.daps.map {|m| m.total_active_writeup.to_i}.join(' ').to_f %></span><% end %> ', 'OSAW': '<% if agent.user.daps.map {|m| m.occurrence_since_dap}.first.to_f >= 1.0 then %><span class="text-danger"><%= agent.user.daps.map{|m| m.occurrence_since_dap}.first %></span><% else %><span><%= agent.user.daps.map{|m| m.occurrence_since_dap}.first %></span><% end %>', 'OSW': '<% if agent.user.daps.map {|m| m.total_occurrences_since_writeup.to_f}.first.to_f > 2.5 then %><span class="text-danger"><%= agent.user.daps.map {|m| m.total_occurrences_since_writeup.to_f}.first %></span><% else %><span><%= agent.user.daps.map {|m| m.total_occurrences_since_writeup.to_f}.first %></span><% end %>', 'AR': '<% if agent.user.daps.map {|m| m.occurrence_since_dap}.first.to_f >= 1.0 || agent.entries.map {|a| a.total_effective_occurrence}.first.to_f > 2.5 && agent.user.daps.map.count {|m| m.total_active_writeup} == 0 || agent.user.daps.map {|m| m.total_occurrences_since_writeup.to_f}.first.to_f > 2.5 then %><span hidden>1</span><span class="text-danger"><%= fa_icon_tag("times-circle-o") %></span><% else %><span hidden>2</span><span class="text-success"><%= fa_icon_tag("check-circle-o") %></span><% end %>', '':'<div class="btn-group"><%= link_to theme_icon_tag("eye"), agent_path(agent.id), "data-toggle": "tooltip", title: "Show", class: "btn btn-link" %><%= link_to theme_icon_tag("pencil-alt"), edit_user_path(agent.user.id), "data-toggle": "tooltip", title: "Edit", class: "btn btn-link" %><%= link_to  theme_icon_tag("trash"), user_path(agent.user.id), confirm: "Are you sure?", method: :delete, data: { confirm: "Are you sure?" }, method: :delete, class: "btn btn-link" %></div>'},<% else %><% end %><% end -%>]
  ).draw();
t.buttons().container()
    .appendTo( $('.col-sm-6:eq(0)', t.table().container() ) );
});
  </script>

<% @title = "Listing Agents" %>

    <% content_for :actions do %>
    <%= link_to new_user_path, class: 'btn btn-primary btn-large pull-right' do %>
      <%= fa_icon_tag "plus" %> Add User
    <% end %>
  <% end %>

<div id="modal-entry">
</div>
<div id="modal-writeup">
</div>

      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="card card-sheet sheet-condensed">
              <div class="table-responsive">
              <table class="table table-striped table-hover table-condensed" id="agentTable">
                <thead>
                  <tr>
                                          <th>Full Name</th>
                                          <th>Email</th>
                                          <th>Department</th>
                                          <th>TAO <small><%= link_to fa_icon_tag("question-circle"), 'data-toggle': 'tooltip', title: 'Total Active Occurrences (180 days)' %></small></th>
                                          <th>TAW <small><%= link_to fa_icon_tag("question-circle"), 'data-toggle': 'tooltip', title: 'Total Active Writeups (90 days)' %></small></th>
                                          <th>OSAW <small><%= link_to fa_icon_tag("question-circle"), 'data-toggle': 'tooltip', title: 'Total Occurrences Since Active Progressive Action' %></small></th>
                                          <th>OSW <small><%= link_to fa_icon_tag("question-circle"), 'data-toggle': 'tooltip', title: 'Total Occurrences Since Active Progressive Action' %></small>
                                          </th>
                                          <th>AR <small><%= link_to fa_icon_tag("question-circle"), 'data-toggle': 'tooltip', title: 'Disciplinary Action Required' %></small></th>
                                        <th></th>
                  </tr>
                </thead>
                <tbody>

                </tbody>
              </table>
            </div>
            </div>  
          </div>
        </div>
      </div>
      <%= javascript_include_tag("https://cdn.datatables.net/select/1.3.0/js/dataTables.select.min.js") %>

