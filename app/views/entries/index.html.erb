<%= stylesheet_link_tag "pagination.css" %>
<% @title = "All Entries" %>

<% content_for :description do %>
  <% end %>
  <% content_for :actions do %>
    <%= link_to new_entry_path, class: 'btn btn-primary btn-large pull-right' do %>
      <%= fa_icon_tag "plus" %> Add Entry
    <% end %>
  <% end %>

<!-- <style>
.pretty th .current {
  padding-right: 12px;
  background-repeat: no-repeat;
  background-position: right center;
}
.pretty th .asc { 
  background-image: url(/images/up_arrow.gif); 
}

.pretty th .desc { 
  background-image: url(/images/down_arrow.gif); 
}
</style> -->

  <script>

$(document).ready(function(t){
var t = $('#entryTable').DataTable({ "pageLength": 10, columns: [ 
              { data: 'Agent'}, 
              { data: 'Department' }, 
              { data: 'Occurrence' },
              { data: 'Value' },
              { data: 'Date' },
              { data: 'Description' },
              { data: '' } ] 
          });
  t.draw();



t.rows.add(
  
  [<% @entries.each do |entry| -%>{'Agent': '<%= entry.user.full_name.truncate(15) %>', 'Department': '<%= entry.department.name.truncate(15) %>', 'Occurrence': '<%= entry.occurrence.name.truncate(15) %>', 'Value': '<%= entry.occurrence.ovalue %>', 'Date': '<%= entry.edate %>', 'Description': '<%= entry.edesc.gsub(/\R+/, " ").truncate(15) %>', '':'<%= link_to theme_icon_tag("eye"), entry, "data-toggle": "tooltip", title: "Show", class: "btn btn-link"%> <%= link_to theme_icon_tag("pencil-alt"), edit_entry_path(entry), "data-toggle": "tooltip", title: "Edit", class: "btn btn-link" %> <%= link_to theme_icon_tag("trash"), entry, "data-toggle": "tooltip", title: "Delete", data: { confirm: "Are you sure?" }, method: :delete, class: "btn btn-link" %>'},<% end -%>]
  ).draw();

$('#entryTable tbody').on('click', function(){
  t.state.save();
})

});
  </script>

<div id="modal-calendar">
</div>
<div id="modal-agent_list">
</div>
    <!-- <i class="fa fa-calendar"></i> Calendar -->
      <div class="container">
        <div class="row">
          <div class="col-md-9">
            <div class="card card-sheet sheet-condensed">
              <div class="mx-auto">

              </div>
              <div class="table-responsive">
              <table class="table table-striped table-hover table-sm-responsive" id="entryTable">
                <thead>
                  <tr>
                                          <th><%= link_to "Agent", :sort => "users.first_name asc" %></th>
                                          <th><%= link_to "Department", :sort => "departments.name asc" %></th>
                                          <th><%= link_to "Occurrence", :sort => "occurrences.name asc" %></th>
                                          <th><%= link_to "Value", :sort => "occurrences.ovalue asc" %></th>
                                          <th><%= link_to "Date", :sort => "edate desc" %></th>
                                          <th><%= link_to "Description", :sort => "edesc" %></th>
                                          <th><!-- Action Button Column --></th>
                  </tr>
                </thead>
                <tbody>
<!--                 <%# @entries.each do |entry| %>

                  <tr>
                                        <%# if entry.user.deleted_at.blank? then %>
                                          <td><%#= entry.user.full_name.truncate(15) %></td>
                                          <td><%#= entry.department.name.truncate(15) %></td>
                                          <td><%#= entry.occurrence.name.truncate(12) %></td>
                                          <td><%#= entry.occurrence.ovalue %></td>
                                          <td><%#= entry.edate %></td>
                                          <td><%#= entry.edesc.truncate(15) %></td>
                                        <td class="actions text-right">
                      <div class="btn-group">
                        <%#= link_to theme_icon_tag("eye"), entry, 'data-toggle': 'tooltip', title: 'Show', class: "btn btn-link" %>
                        <%#= link_to theme_icon_tag("pencil-alt"), edit_entry_path(entry), 'data-toggle': 'tooltip', title: 'Edit', class: "btn btn-link" %>
                        <%#= link_to theme_icon_tag("trash"), entry, 'data-toggle': 'tooltip', title: 'Delete',
                        data: { confirm: 'Are you sure?' }, method: :delete, class: 'btn btn-link' %>
                      </div>
                      </td>
                      <%# else %>
                      <%# end %>
                    </tr>
                    <%# end %> -->
                    </tbody>

                  </table>
                </div>
                  <center><%#= will_paginate(@entries) %></center>
                
                </div>
              </div>    
            <div class="col-md-3">
              <!-- <ul class="nav nav-stacked nav-caret-left card small pb-2  ">
                <li>
                  <h6 class="mt-3 ml-3"><%#= fa_icon_tag "search" %> Search</h6>
                </li>
                <li class="nav-item pr-2 pl-2 pt-2">
                  <%#= form_tag(entries_path, method: "get") do %>
                    <%#= text_field_tag :search, nil, class: "form-control" %>
                    <%#= submit_tag "", style: "display: none;" %>
                  <%# end %>
                </li>
              </ul> -->
              <ul class="nav nav-stacked nav-caret-left card small pb-2  ">
                <li>
                  <h6 class="mt-3 ml-3">Additional Actions</h6>
                </li>
                <li class="nav-item">
                  <%= link_to entries_agent_list_path, :class => "nav-link font-weight-bold", :remote => true, "data-toggle" => "modal", "data-target" => "#modal-agent" do %>
                  <%= fa_icon_tag "list" %> All Agents
                  <% end %>
                </li>
                <li class="nav-item active">
                  <%= link_to entries_calendar_path, :class => "nav-link font-weight-bold", :remote => true, "data-toggle" => "modal", "data-target" => "#modal-window" do %>
                  <%= fa_icon_tag "calendar" %> Calendar
                  <% end %>
                </li>
                <li class="nav-item">
                  <a href="/myresults.csv" class="nav-link font-weight-bold"><i class="fa fa-file-excel-o "></i> Export All</a>
                </li>
              </ul>
            </div>

