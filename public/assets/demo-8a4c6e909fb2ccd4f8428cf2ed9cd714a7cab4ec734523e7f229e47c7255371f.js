function printStats(e){e&&console.log(e),console.log("       Time:",end-start||"(Unknown; your browser does not support the Performance API)","ms"),console.log("  Row count:",rowCount),stepped&&console.log("    Stepped:",stepped),console.log("     Errors:",errorCount),errorCount&&console.log("First error:",firstError)}function buildConfig(){return{delimiter:$("#delimiter").val(),header:$("#header").prop("checked"),dynamicTyping:$("#dynamicTyping").prop("checked"),skipEmptyLines:$("#skipEmptyLines").prop("checked"),preview:parseInt($("#preview").val()||0),step:$("#stream").prop("checked")?stepFn:undefined,encoding:$("#encoding").val(),worker:$("#worker").prop("checked"),comments:$("#comments").val(),complete:completeFn,error:errorFn,download:"remote"==inputType}}function stepFn(e){stepped++,e&&(e.data&&(rowCount+=e.data.length),e.errors&&(errorCount+=e.errors.length,firstError=firstError||e.errors[0]))}function completeFn(e){end=now(),e&&e.errors&&(e.errors&&(errorCount=e.errors.length,firstError=e.errors[0]),e.data&&0<e.data.length&&(rowCount=e.data.length)),printStats("Parse complete"),console.log("    Results:",e);for(var t=0;t<e.data.length;t++)$.ajax({beforeSend:function(){$(".loader").show()},url:"csv_upload",type:"put",data:{acw:e.data[t].ACW,aht:e.data[t].AHT,abnd:e.data[t].Abnd,availability:e.data[t].Availability,callback_calls:e.data[t]["Callback Calls"],callback_talk:e.data[t]["Callback Talk"],date:e.data[t].Date,direct_calls:e.data[t]["Direct Calls"],direct_talk:e.data[t]["Direct Talk"],name:e.data[t].Name,net_login:e.data[t]["Net Login"],occupancy:e.data[t].Occupancy,outbound_calls:e.data[t]["Outb'nd Calls"],outbound_talk:e.data[t]["Outb'nd Talk"],picked:e.data[t].Picked,power_dial:e.data[t]["Power Dial"],queue_calls:e.data[t]["Queue Calls"],queue_talk:e.data[t]["Queue Talk"],recover:e.data[t].Recover,requested_worktime:e.data[t]["Requested Worktime"],shift:e.data[t].Shift,total_break:e.data[t]["Total Break"],total_calls:e.data[t]["Total Calls"],total_login:e.data[t]["Total Login"],total_talk:e.data[t]["Total Talk"],un_ans:e.data[t]["Un Ans"],extension:e.data[t]["User ID"],wrapup_time:e.data[t]["Wrapup Time"]},complete:function(){$(".loader").hide(),location.reload()}});setTimeout(enableButton,100)}function errorFn(e,t){end=now(),console.log("ERROR:",e,t),enableButton()}function enableButton(){$("#submit").prop("disabled",!1)}function now(){return"undefined"!=typeof window.performance?window.performance.now():0}var firstError,start,end,inputType="string",stepped=0,rowCount=0,errorCount=0,firstRun=!0,maxUnparseLength=1e4;$(function(){$("#tab-string").click(function(){$(".tab").removeClass("active"),$(this).addClass("active"),$(".input-area").hide(),$("#input-string").show(),$("#submit").text("Parse"),inputType="string"}),$("#tab-local").click(function(){$(".tab").removeClass("active"),$(this).addClass("active"),$(".input-area").hide(),$("#input-local").show(),$("#submit").text("Parse"),inputType="local"}),$("#tab-remote").click(function(){$(".tab").removeClass("active"),$(this).addClass("active"),$(".input-area").hide(),$("#input-remote").show(),$("#submit").text("Parse"),inputType="remote"}),$("#tab-unparse").click(function(){$(".tab").removeClass("active"),$(this).addClass("active"),$(".input-area").hide(),$("#input-unparse").show(),$("#submit").text("Unparse"),inputType="json"}),$("#remote-normal-file").click(function(){$("#url").val($("#local-normal-file").attr("href"))}),$("#remote-large-file").click(function(){$("#url").val($("#local-large-file").attr("href"))}),$("#remote-malformed-file").click(function(){$("#url").val($("#local-malformed-file").attr("href"))}),$("#submit").click(function(){if("true"!=$(this).prop("disabled")){errorCount=rowCount=stepped=0,firstError=undefined;var e=buildConfig(),t=$("#input").val();if("remote"==inputType?t=$("#url").val():"json"==inputType&&(t=$("#json").val()),$(this).prop("disabled",!0),firstRun?firstRun=!1:console.log("--------------------------------------------------"),"local"==inputType){if(!$("#files")[0].files.length)return alert("Please choose at least one file to parse."),enableButton();$("#files").parse({config:e,before:function(e){start=now(),console.log("Parsing file...",e)},error:function(e,t){console.log("ERROR:",e,t),firstError=firstError||e,errorCount++},complete:function(){end=now(),printStats("Done with all files")}})}else if("json"==inputType){if(!t)return alert("Please enter a valid JSON string to convert to CSV."),enableButton();start=now();var a=Papa.unparse(t,e);end=now(),console.log("Unparse complete"),console.log("Time:",end-start||"(Unknown; your browser does not support the Performance API)","ms"),a.length>maxUnparseLength&&(a=a.substr(0,maxUnparseLength),console.log("(Results truncated for brevity)")),console.log(a),setTimeout(enableButton,100)}else{if("remote"==inputType&&!t)return alert("Please enter the URL of a file to download and parse."),enableButton();start=now();var o=Papa.parse(t,e);console.log("Synchronous results:",o),(e.worker||e.download)&&console.log("Running...")}}}),$("#insert-tab").click(function(){$("#delimiter").val("\t")})});